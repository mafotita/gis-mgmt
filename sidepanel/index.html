<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!--Edit the title of the page-->
    <title>NYC Bike Network</title>
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
    <!--[if lte IE 8]>
      <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.ie.css" />
    <![endif]-->
    <!--Switch between the different themes changing the stylesheet below - light-theme.css |dark-theme.css -->
    <link rel="stylesheet" href="css/light-theme.css">
    <link rel="stylesheet" href="css/makeitresponsive.css">
	<style>
	.button {
				border-radius:6px;
				-webkit-border-radius:6px;
				-moz-border-radius:6px;

				border:1px solid black;
				display:inline-block;
				color: green;
				font-size:14px;
				height:33px;
				line-height:33px;
				width:125px;
				text-decoration:none;
				text-align:center;
			}
			
		.button:hover {
				background-color: gray;
				color:white;
				text-decoration:none;
				font-weight:bold;
			}

		.button:active {
				position:relative;
				top:1px;
				
		}
.selected{
			background-color: black;
}
	</style>
	<script>
		  var map;
		  
		  
		  
		  function init(){
			// initiate leaflet map
			map = new L.Map('map', { 
				minZoom: 10,
				maxZoom: 18,
			  center: [40.7, 	-73.9],
			  zoom: 11
			})

		    L.tileLayer('https://a.tiles.mapbox.com/v3/aaronfraint.gan0g646/{z}/{x}/{y}.png', {
		      attribution: 'Mapbox <a href="http://mapbox.com/about/maps" target="_blank">Terms &amp; Feedback</a>'
		    }).addTo(map);


			var layerUrl = 'http://bikeplanning.cartodb.com/api/v2/viz/5698c62a-5158-11e3-982e-dd91ed83a324/viz.json';

		  var sublayers = [];

		  cartodb.createLayer(map, layerUrl)
			.addTo(map)
			.on('done', function(layer) {
			  
			  // add both layers and the CSS styling for each
			  
			  var subLayerOptions = {
				sql: "SELECT * FROM nyc_bike_routes_052013",
				cartocss: "/** simple visualization */      #nyc_bike_routes_052013{            line-width: 2;            line-color: yellow;            line-opacity: 0.7;	      }      #nyc_bike_routes_052013{        [ft_facilit='Dirt Trail'],          [ft_facilit='Stairs']{                    line-width: 2;            line-color: black;            line-opacity: 0.7;        }      	      }      #nyc_bike_routes_052013{        [ft_facilit='Bridge'],        [ft_facilit=' '],        [ft_facilit=null]          {                        [tf_facilit='Bridge'],            [tf_facilit=null]            {               line-color: blue;              line-opacity: 1;                    [zoom > 13]{                line-width: 8;            	}             	[zoom <= 13]{                line-width: 2;                  	}            }      	}            }      #nyc_bike_routes_052013{        [ft_facilit='Link'],        [ft_facilit=' '],        [ft_facilit=null]          {                        [tf_facilit='Link'],            [tf_facilit=null]            {               line-color: purple;              line-opacity: 1;              line-cap: round;                    [zoom > 13]{                line-width: 8;            	}             	[zoom <= 13]{                line-width: 2;                  	}            }      	}            }      #nyc_bike_routes_052013{        [ft_facilit='Sharrows'],        [ft_facilit='Signed Route'],        [ft_facilit='Bike-Friendly Parking'],        [ft_facilit=' '],        [ft_facilit=null]          {                        [tf_facilit='Sharrows'],            [tf_facilit='Signed Route'],            [tf_facilit='Bike-Friendly Parking'],            [tf_facilit=null]            {               line-color: orange;              line-opacity: 0.7;                    [zoom > 13]{                line-width: 10;            	}             	[zoom <= 13]{                line-width: 3;                  	}            }      	}            }      #nyc_bike_routes_052013::oneline{        [ft_facilit='Standard'],        [ft_facilit='Curbside']          {            [tf_facilit='Sharrows'],            [tf_facilit='Signed Route'],            [tf_facilit='Bike-Friendly Parking']            {               line-color: orange;              line-opacity: 0.7;            line-offset:3;                    [zoom > 13]{                line-width: 5;            	}             	[zoom <= 13]{                line-width: 3;                  	}            }      	}            }      #nyc_bike_routes_052013::twoline{        [ft_facilit='Standard'],        [ft_facilit='Curbside']          {                        [tf_facilit='Sharrows'],            [tf_facilit='Signed Route'],            [tf_facilit='Bike-Friendly Parking']            {               line-color: red;              line-opacity: 0.7;            line-offset:-3;                    [zoom > 13]{                line-width: 5;            	}             	[zoom <= 13]{                line-width: 3;                  	}            }      	}            }      #nyc_bike_routes_052013{        [ft_facilit='Standard'],        [ft_facilit='Curbside'],        [ft_facilit=' '],        [ft_facilit=null]          {                        [tf_facilit='Standard'],            [tf_facilit='Curbside'],            [tf_facilit=null]            {               line-color: red;              line-opacity: 0.7;                    [zoom > 13]{                line-width: 10;            	}             	[zoom <= 13]{                line-width: 3;                  	}            }      	}            }      #nyc_bike_routes_052013{        [ft_facilit='Ped Plaza'],        [ft_facilit='Sidewalk'],        [ft_facilit=' '],        [ft_facilit=null]          {                        [tf_facilit='Ped Plaza'],            [tf_facilit='Sidewalk'],            [tf_facilit=null]            {               line-color: cyan;              line-opacity: 1;                    [zoom > 13]{                line-width: 8;            	}             	[zoom <= 13]{                line-width: 2;                  	}            }      	}            }      #nyc_bike_routes_052013{        [ft_facilit='Protected Path'],        [ft_facilit='Path'],        [ft_facilit='Greenway'],        [ft_facilit=' '],        [ft_facilit=null]          {                        [tf_facilit='Protected Path'],            [tf_facilit='Path'],            [tf_facilit='Greenway'],            [tf_facilit=null]            {               line-color: green;              line-opacity: 0.7;                    [zoom > 13]{                line-width: 12;            	}             	[zoom <= 13]{                line-width: 6;                  	}            }      	}            }"
			  }

			  var sublayer = layer.getSubLayer(0);

			  
			  sublayer.on('featureOver', function(e, pos, latlng, data) {
				sublayer.setCartoCSS(" #nyc_bike_routes_052013::glow{   [cartodb_id=" + data.cartodb_id + "]         {line-width: 25;line-color:yellow;}}   "+ subLayerOptions.cartocss + "#nyc_bike_routes_052013::over{   [cartodb_id=" + data.cartodb_id + "]         {line-width: 4;line-color:cyan;line-dasharray:15, 5;}}   ");
			  });

			  sublayer.on('featureOut', function(e, pos, latlng, data) {
				sublayer.setCartoCSS(subLayerOptions.cartocss);
			  });
			  
			  sublayer.set(subLayerOptions);
			 // sublayer.on('featureClick', function(e, latlng, pos, data, subLayerIndex) {
			//	sublayer[data].setCartoCSS("#nyc_bike_routes_052013{line-color:black; line-width:25;}");
			//});
			  
			  sublayers.push(sublayer);
			  
			  
			  
			  
			}).on('error', function() {
			  //log the error
			});
			
			
			

			// wire up the button queries
			var LayerActions = {
				since2010: function(){
				sublayers[0].setSQL("SELECT * FROM nyc_bike_routes_052013 WHERE moddate > CAST('2009/12/31' as date)");

				  return true;
				},	
				all: function(){
				  sublayers[0].setSQL("SELECT * FROM nyc_bike_routes_052013");
				  return true;
				},		
				termBloom: function(){
				  sublayers[0].setSQL("SELECT * FROM nyc_bike_routes_052013 WHERE moddate > CAST('2001/12/31' as date)");
				  return true;
				},
				termJSK: function(){
				  sublayers[0].setSQL("SELECT * FROM nyc_bike_routes_052013 WHERE moddate > CAST('2006/12/31' as date)");
				  return true;
				},
				onStreet: function(){
				  sublayers[0].setSQL("SELECT * FROM nyc_bike_routes_052013 WHERE ( ft_facilit NOT IN ('Greenway', 'Ped Plaza', 'Sidewalk') OR tf_facilit NOT IN ('Greenway', 'Ped Plaza', 'Sidewalk'))");
				  return true;
				},							
				greenway: function(){
				  sublayers[0].setSQL("SELECT * FROM nyc_bike_routes_052013 WHERE ( ft_facilit IN ('Greenway', 'Ped Plaza', 'Sidewalk') OR tf_facilit IN ('Greenway', 'Ped Plaza', 'Sidewalk'))");
				  return true;
				},	
				pre1970: function(){
				  sublayers[0].setSQL("SELECT * FROM nyc_bike_routes_052013 WHERE instdate < CAST('1971/01/01' as date)");
				  return true;
				},
				the70sto80s: function(){
				  sublayers[0].setSQL("SELECT * FROM nyc_bike_routes_052013 WHERE instdate > CAST('1970/12/31' as date) AND instdate < CAST('1990/12/31' as date)");
				  return true;
				 },
				the90sto02: function(){
				  sublayers[0].setSQL("SELECT * FROM nyc_bike_routes_052013 WHERE instdate > CAST('1989/12/31' as date) AND instdate < CAST('2001/12/31' as date)");
				  return true;
				  },
				the02to10: function(){
				  sublayers[0].setSQL("SELECT * FROM nyc_bike_routes_052013 WHERE instdate > CAST('2001/12/31' as date) AND instdate < CAST('2009/12/31' as date)");
				  return true;
				  },
				};
			
			// make the currently selected button have the selected class
			$('.button').click(function() {
						$('.button').removeClass('selected');
						$(this).addClass('selected');
						
			
						LayerActions[$(this).attr('id')]();
					  });
			
			
			
			
		  }
	  </script>
  </head>
  <body onload=init()>

    <div class="map" id="map"></div>

    <div class="sidepanel">
      <div class="wrapper">

        <h1>NYC Bike Routes</h1>
        <!--Copy and paste the div below for creating content blocks-->
        <hr>
		<p>Hover your mouse over a line to highlight it, and click for more info.</p>
		<hr>
		<p>Filter by <a href="#design">design</a>, <a href="#term">term</a>, or <a href="#time">time</a>.</p>
		<hr>
						<a name="design">Design filters</a>
			<table width="100%" border="0" style="text-align:center;">
				<tr>
					<td colspan="2"><a href="#all" id="all" class="button all">All Data</a></td>
				</tr>
				<tr>
					<td><a href="#onStreet" id="onStreet" class="button onStreet">On Street (only)</a></td>
					<td><a href="#greenway" id="greenway" class="button greenway">Greenway</a></td>
				</tr>
				</table>
		
		
		<hr>
						<a name="term">Term filters</a>
			<table width="100%" border="0" style="text-align:center;">

				<tr>
					<td><a href="#termBloom" id="termBloom" class="button termBloom">Mayor's Term</a></td>
					<td><a href="#termJSK" id="termJSK" class="button termJSK">JSK Term</a></td>
				</tr>
				</table>
				<hr>
				<a name="time">Time filters</a>
				<table width="100%" border="0" style="text-align:center;">
				<tr>
					<td colspan="2"><a href="#pre1970" id="pre1970" class="button pre1970">Pre-1970</a></td>
				</tr>
				<tr>
					<td><a href="#the70sto80s" id="the70sto80s" class="button the70sto80s">1970 to 1989</a></td>
				<td><a href="#the90sto02" id="the90sto02" class="button the90sto02">1990 - 2002</a></td>
				</tr>
				<tr>
					<td><a href="#the02to10" id="the02to10" class="button the02to10">2002 to 2010</a></td>
				<td><a href="#since2010" id="since2010" class="button since2010">Since 2010</a></td>
				</tr>				
				</table>


        <div class="context footer">
           <p>Map designed and coded by <a href="http://aaronfraint.com" target="_blank">Aaron Fraint</a></p>
		   <p>Bike Route GIS data available at <a href="http://nyc.gov/dot/data" target="_blank">NYC DOT's data portal</a></p>
        </div>
      </div>
    </div>

    <script src="https://maps.googleapis.com/maps/api/js?sensor=false&v=3.8"></script>
    <script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>
    <!--Change the URL below in order to change the map that is being shown.
    Go to your map in CartoDB, click on share, and copy the URL undert the API section
    Check the cartodb.js documentation for more info
    http://developers.cartodb.com/documentation/cartodb-js.html-->


  </body>
      </html>
